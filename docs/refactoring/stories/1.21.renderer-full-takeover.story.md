# Story 1.21: Renderer Full Takeover (Remove render.ts)

## Status
Planned

## Story
As a developer finishing the reader UI migration,
I want the Renderer to be the sole source of DOM updates,
so that all UI is store-driven and the legacy `render.ts` is removed.

## Acceptance Criteria
1. All DOM update logic is implemented in `src/reader/ui/renderer.ts` as pure, testable helpers.
2. Renderer subscription derives deltas from the store and calls update helpers exclusively.
3. All external calls to `render.ts` (e.g., `renderCurrentWord`) are removed; UI reacts to store changes.
4. Progress/status text and streaming progress are owned by Renderer (no mixed responsibility).
5. `src/reader/render.ts` has zero references and is deleted.
6. Lint, typecheck, unit, and Playwright tests all pass.

## Tasks / Subtasks
- [ ] Audit and port logic
  - [ ] Identify every DOM write in `src/reader/render.ts`
  - [ ] Move word display/highlight/optimal letter positioning to renderer helpers
  - [ ] Move status text and progress (including streaming progress) to renderer helpers
  - [ ] Ensure visual-effects integration remains intact and localized to renderer
- [ ] Wire renderer subscription
  - [ ] Compute minimal diffs from store state to avoid redundant writes
  - [ ] Ensure first render on bootstrap and teardown unsubscription
- [ ] Remove legacy entry points
  - [ ] Replace any `renderCurrentWord()` style calls with store actions that trigger renderer
  - [ ] Verify no module imports from `src/reader/render.ts`
- [ ] Delete legacy file
  - [ ] Use ripgrep to confirm zero references to `src/reader/render.ts`
  - [ ] Delete file and clean unused exports
- [ ] Tests and quality gates
  - [ ] Add/adjust unit tests for newly added pure helpers (Vitest + JSDOM)
  - [ ] Run `npm run lint` and fix issues
  - [ ] Run `npm run typecheck` and fix issues
  - [ ] Run `npm test` and validate visual behavior manually

## Dev Notes
### Architecture Context
This executes Phase A (Renderer Takeover) from `docs/refactoring/legacy_removal_plan.md`. Renderer becomes the only DOM writer; hybrid UI is removed.

### Risks & Mitigations
- UI regressions from migration → Keep helpers pure and unit-test them; validate with manual visual checks.
- Performance changes → Maintain batched updates and avoid layout thrash.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-26 | 1.0 | Initial story draft | Team |

