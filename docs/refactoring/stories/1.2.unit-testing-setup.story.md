# Story 1.2: Unit Testing Framework Setup

## Status
Draft

## Story
**As a** developer preparing for architectural refactoring,
**I want** Vitest unit testing framework configured and operational,
**so that** I can write unit tests for the new services and ensure safe refactoring with proper test coverage.

## Acceptance Criteria
1. Vitest is added as a dev dependency in `package.json`
2. `vitest.config.ts` configuration file exists in the root directory
3. At least one example unit test is created and passes (e.g., for `encodeHtml` function from `src/common/html.ts`)
4. Unit test can be executed and passes via command line
5. Test framework integration works correctly with existing project structure

## Tasks / Subtasks
- [ ] Add Vitest to project dependencies (AC: 1)
  - [ ] Run `npm install --save-dev vitest` to add Vitest
  - [ ] Verify Vitest appears in `devDependencies` in package.json
- [ ] Create Vitest configuration (AC: 2)
  - [ ] Create `vitest.config.ts` in project root
  - [ ] Configure appropriate test file patterns (*.spec.ts, *.test.ts)
  - [ ] Set up path resolution for src/ imports
  - [ ] Configure coverage if needed
- [ ] Create example unit test (AC: 3)
  - [ ] Create `src/common/html.spec.ts` test file
  - [ ] Write unit test for `encodeHtml` function
  - [ ] Ensure test follows AAA pattern (Arrange, Act, Assert)
- [ ] Verify test execution (AC: 4)
  - [ ] Add test script to package.json if not already present
  - [ ] Run tests via `npm run test:unit` or similar command
  - [ ] Ensure test passes successfully
- [ ] Integration verification (AC: 5)
  - [ ] Ensure existing build process is not affected
  - [ ] Verify Playwright tests still run independently
  - [ ] Confirm TypeScript compilation works with test files

## Dev Notes

### Architecture Context
This story implements Phase 0, Step 0.2 of the refactoring plan, establishing unit testing infrastructure needed for testing the new service-oriented architecture components.

[Source: docs/refactoring/refactoring_plan.md#phase-0-preparation-and-tooling]

### Technical Requirements
- Framework: Vitest (as specified in refactoring plan)
- Test file location: Co-located with source files using `.spec.ts` extension
- Must not interfere with existing Playwright integration tests
- Should support TypeScript out of the box

### Current Architecture Context
The extension currently uses Playwright for end-to-end testing. This adds unit testing capability for isolated component/service testing that will be crucial for the upcoming service extraction phases.

[Source: docs/architecture.md#testing-strategy]

### Testing Standards
- Follow AAA pattern (Arrange, Act, Assert)
- Use descriptive test names
- Mock external dependencies appropriately
- Test files should be co-located with source files
- Use `.spec.ts` extension for test files

### Linting Strategy
- When introducing new lint or type checks, add existing files to the ignore list so the baseline continues to pass.
- Whenever you modify one of the ignored files, remove it from the ignore list and resolve any violations so that the updated code complies with the stricter rules.

### File Structure Expected
```
src/
  common/
    html.ts
    html.spec.ts  # New test file
vitest.config.ts    # New config file
```

### Critical Success Criteria
- Unit testing framework operational and isolated from existing tests
- Example test demonstrates framework is working correctly
- Foundation established for testing new services in subsequent phases

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-25 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*This section will be populated by the QA agent after implementation review*