# Story 1.18: Delete Old Reader Files

## Status
Draft

## Story
**As a** developer completing the architecture refactoring,
**I want** all legacy reader files deleted and imports updated,
**so that** the codebase contains only the new service-oriented architecture without any legacy code.

## Acceptance Criteria
1. Legacy reader files are identified and safely deleted: `state.ts`, `render.ts`, old `controls.ts`, `playback.ts`, `text.ts`
2. All imports from deleted files are updated to use new service and store imports
3. Build system continues to work correctly without deleted files
4. All existing functionality is preserved through new architecture
5. All Playwright tests continue to pass
6. No dead code or unused imports remain

## Tasks / Subtasks
- [ ] Identify files for deletion (AC: 1)
  - [ ] Confirm `src/reader/state.ts` is no longer used
  - [ ] Confirm `src/reader/render.ts` is no longer used
  - [ ] Confirm old `src/reader/controls.ts` is no longer used
  - [ ] Confirm `src/reader/playback.ts` is no longer used
  - [ ] Confirm `src/reader/text.ts` is no longer used
  - [ ] Verify no components still import from these files
- [ ] Update imports before deletion (AC: 2)
  - [ ] Find all imports from legacy files throughout codebase
  - [ ] Update imports to use new services and store
  - [ ] Update any barrel exports or index files
  - [ ] Ensure all references point to new architecture components
- [ ] Safely delete legacy files (AC: 1)
  - [ ] Delete `src/reader/state.ts`
  - [ ] Delete `src/reader/render.ts`
  - [ ] Delete old `src/reader/controls.ts`
  - [ ] Delete `src/reader/playback.ts`
  - [ ] Delete `src/reader/text.ts`
  - [ ] Confirm files are removed from version control
- [ ] Verify build system integrity (AC: 3)
  - [ ] Run `npm run build:chrome` to ensure clean build
  - [ ] Check for any missing import errors
  - [ ] Verify bundler can resolve all imports
  - [ ] Confirm no references to deleted files in build process
- [ ] Preserve functionality (AC: 4)
  - [ ] Test complete reader functionality works identically
  - [ ] Verify all user interactions work correctly
  - [ ] Test all extension features end-to-end
  - [ ] Confirm no functionality lost in deletion process
- [ ] Comprehensive testing (AC: 5)
  - [ ] Run full Playwright test suite
  - [ ] Fix any test failures from file deletions
  - [ ] Verify all tests pass consistently
  - [ ] Test manual scenarios not covered by automated tests
- [ ] Clean up dead code (AC: 6)
  - [ ] Remove any unused imports revealed by deletions
  - [ ] Clean up any orphaned utility functions
  - [ ] Remove any commented-out legacy code
  - [ ] Update any documentation references to deleted files
- [ ] Final verification
  - [ ] Manual testing of complete reader workflow
  - [ ] Performance testing to ensure no regressions
  - [ ] Code review to ensure clean, maintainable result
  - [ ] Run `npm run typecheck` and `npm run lint` to ensure code quality

## Dev Notes
### Linting Strategy
- When introducing new lint or type checks, add existing files to the ignore list so the baseline continues to pass.
- Whenever you modify one of the ignored files, remove it from the ignore list and resolve any violations so that the updated code complies with the stricter rules.
- Remove this story's touched files from the `.eslintignore` baseline created in Story 1.1 before committing.


### Architecture Context
This story implements Phase 5, Step 5.3 of the refactoring plan, completing the reader refactoring by removing all legacy code and finalizing the clean service-oriented architecture.

[Source: docs/refactoring/refactoring_plan.md#phase-5-implement-playbackservice-and-finalize-reader]

### Files to be Deleted
The following legacy files should be completely replaced by new architecture:
- `src/reader/state.ts` → Replaced by Zustand store in `src/reader/state/`
- `src/reader/render.ts` → Replaced by Renderer in `src/reader/ui/renderer.ts`
- `src/reader/controls.ts` → Replaced by UIControls in `src/reader/ui/controls.ts`
- `src/reader/playback.ts` → Replaced by PlaybackService in `src/reader/playback/`
- `src/reader/text.ts` → Functionality distributed to services

### New Architecture Mapping
Legacy → New Architecture:
```
state.ts → reader/state/reader.store.ts (Zustand)
render.ts → reader/ui/renderer.ts (DOM updates)
controls.ts → reader/ui/controls.ts (Event handling)
playback.ts → reader/playback/playback.service.ts (Timing)
text.ts → TimingService + AIPreprocessingService
```

### Import Update Strategy
Replace imports systematically:
```typescript
// Replace:
import { state } from './state.js'
// With:
import { useReaderStore } from './state/reader.store.js'

// Replace:
import { updateDisplay } from './render.js'
// With:
// No direct import needed - Renderer handles this reactively

// Replace:
import { bindControls } from './controls.js'
// With:
import { UIControls } from './ui/controls.js'
```

### Technical Requirements
- Must verify no component depends on deleted files
- Should update all import statements before deletion
- Must ensure build system has no references to deleted files
- Should result in cleaner, more organized codebase

### Risk Management
- Verify comprehensive test coverage before deletion
- Ensure all functionality is accounted for in new architecture
- Check that no external components depend on deleted exports
- Maintain ability to rollback if issues are discovered

### Testing Strategy
- Run tests before and after each file deletion
- Test complete reader workflow manually
- Pay special attention to edge cases and error scenarios
- Verify performance is maintained

### Expected Results
After this story:
- Clean service-oriented architecture with no legacy code
- All functionality preserved in new architecture
- Improved code organization and maintainability
- Foundation complete for future enhancements

### Documentation Updates
May need to update:
- Architecture documentation
- Developer guides
- Code comments referencing old structure
- README or setup instructions

### Critical Success Criteria
- All legacy files successfully deleted
- All imports updated to new architecture
- All functionality preserved exactly
- All tests passing
- Clean, maintainable codebase achieved

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-25 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*This section will be populated by the QA agent after implementation review*