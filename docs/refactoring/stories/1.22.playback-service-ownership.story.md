# Story 1.22: PlaybackService Full Ownership (Remove playback.ts)

## Status
Planned

## Story
As a developer stabilizing playback,
I want PlaybackService to own the scheduling loop end-to-end,
so that timing and progression use services and store actions only, and `playback.ts` is deleted.

## Acceptance Criteria
1. Scheduling (`scheduleNextWord`, delay calculation) lives in `src/reader/playback/playback.service.ts` only.
2. PlaybackService uses TimingService for durations and updates the store for index/status/progress.
3. All controls call `PlaybackService.play/pause/restart` (no legacy start/stop bridging).
4. No references to `src/reader/playback.ts`; file is deleted.
5. Playback timing behavior matches legacy (unit tests with fake timers cover the service).
6. Lint, typecheck, unit, and Playwright tests all pass.

## Tasks / Subtasks
- [ ] Migrate loop
  - [ ] Port timer setup/cleanup and next-word scheduling into PlaybackService
  - [ ] Centralize delay computation via TimingService + current store state
- [ ] Store-driven mutations
  - [ ] Replace legacy mutations with store actions (index/status/progress)
  - [ ] Ensure end-of-queue handling and restart semantics unchanged
- [ ] Controls integration
  - [ ] Update controls wiring to call PlaybackService methods only
  - [ ] Verify WPM changes reflow durations without stale timers
- [ ] Remove legacy file
  - [ ] Confirm zero references to `src/reader/playback.ts`
  - [ ] Delete file and any unused exports
- [ ] Tests and quality gates
  - [ ] Add/adjust PlaybackService unit tests (Vitest + fake timers)
  - [ ] Run `npm run lint`
  - [ ] Run `npm run typecheck`
  - [ ] Run `npm test` (Playwright) and manual playback checks

## Dev Notes
### Architecture Context
Implements Phase B (PlaybackService Full Ownership) from `docs/refactoring/legacy_removal_plan.md`.

### Risks & Mitigations
- Cadence regressions → Lock behaviors with fake-timer unit tests; validate with long samples.
- Timer leaks → Single-clear path and idempotent pause/stop.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-26 | 1.0 | Initial story draft | Team |

